# Настройка TLS соединения на почтовом сервере с использованием сертификата OpenSSL
Описание возможностей службы OpenSSL по генерации сертификатов представлено здесь: https://www.openssl.org/docs/man1.0.2/man1/openssl-req.html
# Используемые ВМ
* ВМ CentOS 8 Stream с установленной службой OpenSSL (стоит по умолчанию).
* 2 ВМ Windows Server 2019 с установленным почтовым сервером hMailServer с созданными учётными записями.
* Почтовый клиент Mozilla ThunderBird.
# Настройка использования сертификата, созданного в OpenSSL на почтовом сервере hMailServer
Для использования сертификата на hMailServer необходимо провести следующие действия:
1. Зайти в консоль управления hMailServer.
2. Перейти в раздел _Settings -> Advanced -> SSL Certificates_.
3. Добавить пару сертификат+ключ на сервер.
4. Перейти в раздел _TCP/IP Ports_ и изменить способ подключения для портов с _none_ на _STARTTLS_ или _SSL/TLS_, после чего выбрать в списке добавленный сертификат.
# Примеры команд OpenSSL
Служба OpenSSL позволяет создавать самоподписанные сертификаты различных расширениях (pem, cer, crt, der) в паре с ключами шифрования, либо на основе уже имеющихся ключей.
Для создания самоподписанного сертификата в паре с ключом шифрования используется следующая команда (в примере используется синтаксис OpenSSL версии 1.0.2):

`openssl req -x509 -newkey rsa:2048 -keyout ./cert-key.pem -days 365 -out ./cert-sert.pem -nodes`

Для создания сертификата на основе уже имеющегося ключа используется следующая команда:

`openssl req -x509 -key ./cert-key.pem -days 365 -out ./cert-sert.pem -nodes`

Для создания ключа шифрования отдельно от сертификата используется следующая команда:

`openssl genrsa -out ./key.key`

Значение аргументов:

* `req` - используется для создания сертификатов;
* `genrsa` - используется для генерации ключей шифрования с помощью RSA;
* `-x509` - аргумент, указывающий на создание самоподписанного сертификата;
* `-newkey rsa:2048` - создание нового ключа с алгоритмом _rsa_;
* `-keyout` - путь, куда будет сохранён файл ключа в расширении _.pem_;
* `-days 365` - срок действия сертификата в днях;
* `-out` - путь, куда будет сохранён сертификат в расширении _.pem_; 
* `-nodes` - аргумент, запрещающий шифрование выходного файла ключа;
* `-new` - создание сертификата на основе существующего ключа.



